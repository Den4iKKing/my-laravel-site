import{c as o,o as a,a as e,r as n,b as c,w as m,v as T,u as L,F as x,d as b,e as g,h as G,B as U,t as i,W as D,z as w,n as N,g as J,S as Q}from"./app-B4k5rrsx.js";import{R as _}from"./MainModal-CACzSMUH.js";import{_ as Y}from"./Dashboard-D-iSJIvD.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function ee(v,$){return a(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})])}const te={class:"mb-4 flex justify-between items-center"},se={class:"relative w-1/3"},le={class:"bg-gray-800 p-4 rounded-md"},ae={class:"w-full table-auto text-white"},oe={class:"px-4 py-2 flex items-center"},re=["src"],ne={class:"px-4 py-2"},ie={class:"px-4 py-2"},ue={class:"px-4 py-2"},de={class:"px-4 py-2 flex space-x-2"},ce=["onClick"],ve=["onClick"],pe=["onClick"],ye=["onClick"],he={class:"mt-4 flex justify-center items-center space-x-2"},fe={class:"space-y-4"},me={key:0,class:"space-y-4"},xe={class:"max-h-96 overflow-y-auto"},be={class:"w-full table-auto text-white"},ge={class:"px-4 py-2"},we={class:"px-4 py-2"},_e={class:"px-4 py-2"},ke={key:0,class:"flex justify-center py-4"},Ce={key:1,class:"flex justify-center py-4"},Se={key:2,class:"text-white text-center py-4"},Me={key:0,class:"space-y-4"},Oe={class:"max-h-96 overflow-y-auto"},je={class:"flex items-center"},Te=["src"],Ue={class:"text-white font-medium"},De=["onClick"],Be={key:0,class:"flex justify-center py-4"},He={key:1,class:"flex justify-center py-4"},Ve={key:2,class:"text-white text-center py-4"},Le={class:"text-white"},Ne={layout:Y},Ae=Object.assign(Ne,{__name:"users",props:{users:Object,filters:Object},setup(v){const k=n(v.filters.search||""),r=n({}),C=n(!1),S=n(!1),M=n(!1),O=n(!1),p=n([]),d=n(null),y=n(!1),h=n(!1),j=n([]),B=n(null),E=()=>{D.get(route("users.dashboard"),{search:k.value},{preserveState:!0,replace:!0})},F=l=>{r.value={...l},C.value=!0},R=l=>{r.value={...l},S.value=!0},A=async l=>{r.value={...l},M.value=!0,await z(l.id)},P=async l=>{r.value={...l},O.value=!0,await I(),j.value.length>0&&(B.value=j.value[0].id,await H())},z=async l=>{y.value=!0;try{const t=await w.get(route("users.purchases",l));p.value=t.data.purchases}catch(t){console.error("Ошибка при загрузке истории покупок:",t)}finally{y.value=!1}},I=async()=>{try{const l=await w.get(route("servers.list"));j.value=l.data.servers}catch(l){console.error("Ошибка при загрузке серверов:",l)}},H=async()=>{if(B.value){h.value=!0;try{const l=await w.get(route("users.cart",{user:r.value.id,server:1}));d.value=l.data.cart}catch(l){console.error("Ошибка при загрузке корзины:",l),d.value={items:[]}}finally{h.value=!1}}},K=async l=>{if(confirm("Вы уверены, что хотите удалить этот предмет из корзины?"))try{await w.delete(route("users.cart.remove",{user:r.value.id,server:1,item:l})),await H()}catch(t){console.error("Ошибка при удалении предмета из корзины:",t)}},u=()=>{C.value=!1,S.value=!1,M.value=!1,O.value=!1,p.value=[],d.value=null},V=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),W=()=>{D.put(route("users.update",r.value.id),r.value,{headers:{"X-CSRF-TOKEN":V},onSuccess:u})},X=()=>{D.delete(route("users.destroy",r.value.id),{headers:{"X-CSRF-TOKEN":V},onSuccess:u})},q=l=>{switch(l){case"Admin":return"bg-red-500 text-white";default:return"bg-green-500 text-white"}},Z=l=>new Date(l).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return(l,t)=>(a(),o("div",null,[t[14]||(t[14]=e("h1",{class:"text-2xl font-semibold text-white mb-4"},"Пользователи",-1)),e("div",te,[e("div",se,[m(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>k.value=s),onInput:E,type:"text",placeholder:"Поиск по Name...",class:"w-full bg-gray-700 text-white p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-500"},null,544),[[T,k.value]]),c(L(ee),{class:"absolute right-2 top-2 w-5 h-5 text-gray-400"})])]),e("div",le,[e("table",ae,[t[4]||(t[4]=e("thead",null,[e("tr",null,[e("th",{class:"px-4 py-2 text-left"},"Игрок"),e("th",{class:"px-4 py-2 text-left"},"SteamID"),e("th",{class:"px-4 py-2 text-left"},"Баланс"),e("th",{class:"px-4 py-2 text-left"},"Группа"),e("th",{class:"px-4 py-2 text-left"},"Действия")])],-1)),e("tbody",null,[(a(!0),o(x,null,b(v.users.data,s=>(a(),o("tr",{key:s.id,class:"border-t border-gray-700 hover:bg-gray-700 transition-all duration-200"},[e("td",oe,[e("img",{src:s.avatar,alt:"avatar",class:"w-8 h-8 rounded-full mr-3"},null,8,re),e("span",null,i(s.name),1)]),e("td",ne,i(s.steamid),1),e("td",ie,i(s.balance)+" ₽",1),e("td",ue,[e("span",{class:N([q(s.group),"inline-block px-3 py-1 rounded-full text-xs font-semibold"])},i(s.group),3)]),e("td",de,[e("button",{onClick:f=>F(s),class:"text-blue-400 hover:text-blue-300"},"Редактировать",8,ce),e("button",{onClick:f=>A(s),class:"text-yellow-400 hover:text-yellow-300"},"История",8,ve),e("button",{onClick:f=>P(s),class:"text-green-400 hover:text-green-300"},"Корзина",8,pe),e("button",{onClick:f=>R(s),class:"text-red-400 hover:text-red-300"},"Удалить",8,ye)])]))),128))])])]),e("div",he,[(a(!0),o(x,null,b(v.users.links,s=>(a(),J(L(Q),{key:s.label,href:s.url,innerHTML:s.label,class:N([["px-4 py-2 rounded-md",s.active?"bg-gray-700 text-white":"bg-gray-600 text-gray-300 hover:bg-gray-500",!s.url&&"cursor-not-allowed opacity-50"],"transition-all duration-200"])},null,8,["href","innerHTML","class"]))),128))]),c(_,{isOpen:C.value,title:"Редактирование пользователя",confirmText:"Сохранить",onClose:u,onConfirm:W},{default:g(()=>[e("div",fe,[e("div",null,[t[5]||(t[5]=e("label",{class:"text-white block mb-2"},"Баланс:",-1)),m(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>r.value.balance=s),type:"number",class:"w-full p-2 rounded bg-gray-700 text-white"},null,512),[[T,r.value.balance]])]),e("div",null,[t[6]||(t[6]=e("label",{class:"text-white block mb-2"},"Бонусный баланс:",-1)),m(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>r.value.bonus_balance=s),type:"number",class:"w-full p-2 rounded bg-gray-700 text-white"},null,512),[[T,r.value.bonus_balance]])]),e("div",null,[t[8]||(t[8]=e("label",{class:"text-white block mb-2"},"Группа:",-1)),m(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>r.value.group=s),class:"w-full p-2 rounded bg-gray-700 text-white"},t[7]||(t[7]=[e("option",{value:"user"},"Пользователь",-1),e("option",{value:"Admin"},"Администратор",-1)]),512),[[G,r.value.group]])])])]),_:1},8,["isOpen"]),c(_,{isOpen:M.value,title:"История покупок",confirmText:"Закрыть",onClose:u,onConfirm:u},{default:g(()=>[p.value.length?(a(),o("div",me,[e("div",xe,[e("table",be,[t[9]||(t[9]=e("thead",{class:"sticky top-0 bg-gray-800"},[e("tr",null,[e("th",{class:"px-4 py-2 text-left"},"Предмет"),e("th",{class:"px-4 py-2 text-left"},"Цена"),e("th",{class:"px-4 py-2 text-left"},"Дата")])],-1)),e("tbody",null,[(a(!0),o(x,null,b(p.value,s=>(a(),o("tr",{key:s.id,class:"border-t border-gray-700 hover:bg-gray-700 transition-all duration-200"},[e("td",ge,i(s.item_name),1),e("td",we,i(s.price)+" ₽",1),e("td",_e,i(Z(s.created_at)),1)]))),128))])])]),y.value?(a(),o("div",ke,t[10]||(t[10]=[e("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"},null,-1)]))):U("",!0)])):y.value?(a(),o("div",Ce,t[11]||(t[11]=[e("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"},null,-1)]))):(a(),o("div",Se," У пользователя нет истории покупок "))]),_:1},8,["isOpen"]),c(_,{isOpen:O.value,title:"Корзина пользователя",confirmText:"Закрыть",onClose:u,onConfirm:u},{default:g(()=>[d.value&&d.value.items&&d.value.items.length?(a(),o("div",Me,[e("div",Oe,[(a(!0),o(x,null,b(d.value.items,s=>(a(),o("div",{key:s.shop_cart_id,class:"bg-gray-700 p-3 rounded-md mb-3 flex justify-between items-center"},[e("div",je,[s.image?(a(),o("img",{key:0,src:s.image,alt:"item",class:"w-10 h-10 object-cover rounded mr-3"},null,8,Te)):U("",!0),e("div",null,[e("p",Ue,i(s.name),1)])]),e("button",{onClick:f=>K(s.shop_cart_id),class:"bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-md text-sm transition-all duration-200"}," Удалить ",8,De)]))),128))]),h.value?(a(),o("div",Be,t[12]||(t[12]=[e("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"},null,-1)]))):U("",!0)])):h.value?(a(),o("div",He,t[13]||(t[13]=[e("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"},null,-1)]))):(a(),o("div",Ve," Корзина пользователя пуста "))]),_:1},8,["isOpen"]),c(_,{isOpen:S.value,title:"Удаление пользователя",confirmText:"Удалить",onClose:u,onConfirm:X},{default:g(()=>[e("p",Le,'Вы уверены, что хотите удалить пользователя "'+i(r.value.name)+'"?',1)]),_:1},8,["isOpen"])]))}});export{Ae as default};
